---
description: Perform systematic refactoring of code while maintaining functionality and improving quality
allowed-tools: Read(*), Grep(*), Glob(*), Edit(*), MultiEdit(*), Bash(make test:*), Bash(make fmt:*), TodoWrite(*)
---

# Code Refactoring Assistant

指定されたコードをリファクタリングし、機能を維持しながらコード品質を向上させます。

## Target: ${1:対象ファイルまたはディレクトリ}

## Refactoring Process

### 1. 現状分析
- 対象コードの構造と依存関係を理解
- 既存のテストケースを確認（存在しない場合は作成が必要）
- リファクタリング対象の特定

### 2. テスト作成（TDD原則）
- **既存テストがない場合**: 現在の動作を保証するテストを作成
- **既存テストがある場合**: テストカバレッジを確認し、不足分を補完
- リファクタリング前にすべてのテストが通ることを確認

### 3. リファクタリング計画
以下の観点から改善点を特定：
- **可読性**: 変数名、関数名、コメント
- **保守性**: 関数の分割、重複コードの除去
- **パフォーマンス**: 不要な処理の最適化
- **設計**: SOLID原則、依存性注入
- **テスタビリティ**: モック可能性、単一責任

### 4. 実装
1. テストが通ることを確認（`make test`）
2. 小さな単位でリファクタリングを実行
3. 各ステップでテストを実行
4. コードフォーマットを適用（`make fmt`）

### 5. 検証
- すべてのテストが通ることを確認
- パフォーマンスの劣化がないことを確認
- 外部インターフェースが変更されていないことを確認

## Refactoring Guidelines

### Go言語の場合
- **命名規則**: Go の慣例に従う（PascalCase/camelCase）
- **エラーハンドリング**: 適切なerror wrapping
- **インターフェース**: 必要に応じて抽象化
- **パッケージ構造**: internal/ ディレクトリの活用
- **テストファイル**: `*_test.go` 形式で作成

### 共通ガイドライン
- **Single Responsibility Principle**: 各関数は単一の責任を持つ
- **DRY Principle**: 重複コードの除去
- **YAGNI**: 不要な複雑性を避ける
- **テストカバレッジ**: リファクタリング後もカバレッジを維持

## Safety Measures

1. **テスト優先**: リファクタリング前に必ずテストを作成または確認
2. **テスト実行**: 各変更後に `make test` を実行
3. **コードフォーマット**: 各変更後に `make fmt` を実行
4. **小さな変更**: 一度に大きな変更をしない
5. **機能保持**: 外部インターフェースを変更しない

## TDD Workflow Integration

1. 🧪 **Test**: 既存機能のテスト作成/確認
2. 🛠️ **Refactor**: 小さな単位でリファクタリング実行
3. 🔄 **Verify**: テスト実行で動作確認
4. ✅ **Test**: `make test` で全体テスト
5. 🎨 **Format**: `make fmt` でコード整形
6. 💾 **Commit**: 意味のある単位でコミット

## Output Format

リファクタリング完了後、以下を提供：
- 変更内容の要約
- 改善された点
- 作成したテストの説明
- 今後の改善提案（もしあれば）